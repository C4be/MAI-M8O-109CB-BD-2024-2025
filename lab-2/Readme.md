# Лабораторная работа №2 

Тема: Глава 3 из [книги](https://edu.postgrespro.ru/sql_primer.pdf). Упр 1-4.

Группа: М8О-109СВ-24

Выполнил: **Гимазетдинов Дмитрий Русланович**

---

## Упражнение 1
### Дано:

Попробуйте ввести в таблицу `aircrafts` строку с таким значением атрибута «Код самолета» (`aircraft_code`), которое вы уже вводили, например:

```sql
INSERT INTO aircrafts
VALUES ( 'SU9', 'Sukhoi SuperJet-100', 3000 );
```

Вы получите сообщение об ошибке.

```bash
ОШИБКА: повторяющееся значение ключа нарушает ограничение
уникальности "aircrafts_pkey"
ПОДРОБНОСТИ: Ключ "(aircraft_code)=(SU9)" уже существует.
```
Подумайте, почему появилось сообщение. Если вы забыли структуру таблицы `aircrafts`, то можно вывести ее определение на экран с помощью команды

```code
postgres=# \d aircrafts
```

### Решение:

1. Запустим терминал `psql` от имени пользователя `postgres`.
   
    Команды:
   - Текущее соединение:
    ```bash
    postgres=# \c
    ```
    *You are now connected to database "postgres" as user "postgres".*

   - Подключиться к базе данных `demo`:
    ```bash
    postgres=# \c demo
    ```
    *You are now connected to database "demo" as user "postgres".*

2. Рассмотрим структуру `aircrafts`:
```bash
                View "bookings.aircrafts"
   Column     |     Type     | Collation | Nullable | Default 
--------------+--------------+-----------+----------+---------
aircraft_code | character(3) |           |          | 
model         | text         |           |          | 
range         | integer      |           |          | 
``` 

3. Рассмотрим запрос создания вьюшки `aircrafts`, которая служит для того, чтобы быть мультиязыковой:
![aircrafts](lab2.1.png)
Эта вьюшка создана на основе `aircrafts_data`:

4. Рассмотрим ее 
![aircrafts_data](lab2.2.png)
Поле `aircraft_code` является сурргогатным первичным ключом, а первичный ключ должен быть уникальным. Поэтому и была ошибка.

---

## Упражнение 2
### Дано:

Предложение `ORDER BY` команды `SELECT` позволяет отсортировать данные при выводе. По умолчанию сортировка выполняется по возрастанию значений атрибута, указанного в этом предложении. Но можно упорядочить строки и по убыванию значения атрибута. Для этого нужно после имени атрибута в предложении `ORDER BY` добавить ключевое слово `DESC` (это сокращение от слова descendant — убывающий порядок). *Самостоятельно напишите команду для выборки всех строк из таблицы `aircrafts`, чтобы строки были упорядочены по убыванию значения атрибута «Максимальная дальность полета, км» (`range`).*

### Решение:

Select
```sql
select t.* 
  from aircrafts t

order by t.range desc;
```

Result
```bash
 aircraft_code |        model        | range 
---------------+---------------------+-------
 773           | Боинг 777-300       | 11100
 763           | Боинг 767-300       |  7900
 319           | Аэробус A319-100    |  6700
 320           | Аэробус A320-200    |  5700
 321           | Аэробус A321-200    |  5600
 733           | Боинг 737-300       |  4200
 SU9           | Сухой Суперджет-100 |  3000
 CR2           | Бомбардье CRJ-200   |  2700
 CN1           | Сессна 208 Караван  |  1200
(9 rows)
```

---

## Упражнение 3
### Дано:

Команда `UPDATE` позволяет в процессе обновления выполнять арифметические действия над значениями, находящимися в строках таблицы. Представим себе, что двигатели самолета Sukhoi SuperJet стали в два раза экономичнее, вследствие чего дальность полета этого лайнера возросла ровно в два раза. Команда `UPDATE` позволяет увеличить значение атрибута range в строке, хранящей информацию об этом самолете, даже не выполняя предварительно выборку с целью выяснения текущего значения этого атрибута. При присваивании нового значения атрибуту `range` можно справа от знака «=» написать не только числовую константу, но и целое выражение. В нашем случае оно будет простым:

```bash 
range = range * 2.
``` 

Самостоятельно напишите команду `UPDATE` полностью, при этом не забудьте, что увеличить дальность полета нужно только у одной модели — Sukhoi SuperJet, поэтому необходимо использовать условие `WHERE`. Затем с помощью команды `SELECT` проверьте полученный результат.

### Решение:

Посмотрим значение ДО:
```sql
select * from aircrafts where model = 'Сухой Суперджет-100';
```
```bash
 aircraft_code |        model        | range 
---------------+---------------------+-------
 SU9           | Сухой Суперджет-100 |  3000
(1 row)
```
Далее изменим значение `range`: 
```sql
update aircrafts
   set range = range * 2
 where model = 'Сухой Суперджет-100';
```
Посмотрим значение ПОСЛЕ:
```sql
select * from aircrafts where model = 'Сухой Суперджет-100';
```
```bash
 aircraft_code |        model        | range 
---------------+---------------------+-------
 SU9           | Сухой Суперджет-100 |  6000
(1 row)
```

---

## Упражнение 4
### Дано: 

Если в предложении `WHERE` команды `DELETE` вы укажете логически и синтаксически корректное условие, но строк, удовлетворяющих этому условию, в таблице не окажется, то в ответ СУБД выведет сообщение
```
DELETE 0
```
Такая ситуация не является ошибкой или сбоем в работе СУБД. Например, если после удаления какой-то строки вы повторно попытаетесь удалить ее же, то получите именно такое сообщение.
*Самостоятельно смоделируйте описанную ситуацию, подобрав условие, которому гарантированно не соответствует ни одна строка в таблице «Самолеты» (`aircrafts`).*

### Решение:

```sql
delete from aircrafts        
where aircraft_code = 'XYZ';

-- Результат: DELETE 0
```

